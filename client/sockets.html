<html>
  <head>
    <script
      src="https://cdn.socket.io/4.3.2/socket.io.min.js"
      integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs"
      crossorigin="anonymous"
    ></script>
    <script>
      let socket;
      (async () => {
        const response = await fetch('/user/linkWs', {
          method: 'GET',
          mode: 'cors',
          cache: 'no-cache',
          credentials: 'same-origin',
          headers: { 'Content-Type': 'application/json' },
        });
        const linkWsResult = await response.json();
        window.linkCode = linkWsResult.data.linkCode;

        socket = io(location.origin);

        socket.on('connect', function () {
          console.log('Connected, socket.id=', socket.id);
          socket.emit('linkSession', window.linkCode);
        });
        socket.on('disconnect', function () {
          console.log('Disconnected');
        });
        socket.on('message', function (data) {
          console.log(data);
          document.getElementById('msg').innerHTML = data;
        });
      })();
    </script>
  </head>

  <body>
    <input type="button" id="theButton" value="Send user/getOne" />
    <br />
    <br />
    <div id="msg"></div>
    <script>
      const theDiv = document.getElementById('msg');

      function sendMess() {
        fetch('/user/getOne?userId=1', {
          method: 'GET',
          mode: 'cors',
          cache: 'no-cache',
          credentials: 'same-origin',
          headers: { 'Content-Type': 'application/json' },
        });
      }
      theButton.addEventListener('click', sendMess);
    </script>
  </body>
</html>
